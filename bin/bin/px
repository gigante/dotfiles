#!/bin/bash

function help() {
    cat <<END
PX - aliases for distro package managers
Usage: px <command> [<args>]

Some useful dk commands are:
   add     install package
   rm      remove package
   up      upgrade packages
   clean   cleanup cache
   <pkg>   search for <pkg> package
END
    exit 1
}

function run_yay() {
    command=$1
    pkg=$2
    case "$command" in
    add) yay -S "$pkg" ;;
    rm) yay -R "$pkg" ;;
    up) yay -Syyu ;;
    clean) yay -Sc ;;
    *) yay "$command" ;;
    esac
}

function run_dnf() {
    command=$1
    pkg=$2
    case "$command" in
    add) sudo dnf install -y "$pkg" ;;
    rm) sudo dnf remove "$pkg" ;;
    up) sudo dnf upgrade ;;
    clean) sudo dnf autoremove -y && sudo dnf clean all ;;
    *) sudo dnf search "$command" ;;
    esac
}

function run_apt() {
    command=$1
    pkg=$2
    case "$command" in
    add) sudo apt install -y "$pkg" ;;
    rm) sudo apt remove -y "$pkg" ;;
    up) sudo apt update && sudo apt upgrade ;;
    clean) sudo apt autoremove -y ;;
    *) sudo apt search "$command" ;;
    esac
}

function main() {
    command=$1
    [[ -z "$command" ]] && help && exit 1

    distro=$(sed -n 's/^ID=//p' /etc/os-release)
    pkg=$2

    case "$distro" in
    arch) run_yay $command $pkg ;;
    fedora) run_dnf $command $pkg ;;
    debian | ubuntu) run_apt $command $pkg ;;
    *) echo "px doesnt support your distro" ;;
    esac
}

main "$@"
