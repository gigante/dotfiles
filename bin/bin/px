#!/bin/bash

function help() {
    cat <<END
PX - aliases for distro package managers
Usage: px <command> [<args>]

Some useful dk commands are:
   add     install package
   rm      remove package
   up      upgrade packages
   sync    update repo list
   clean   cleanup cache
   <pkg>   search for <pkg> package
END
    exit 1
}

function run_yay() {
    case "$command" in
    add) yay -S "$pkg" ;;
    rm) yay -R "$pkg" ;;
    up) yay -Syyu ;;
    sync) yay -Sy ;;
    clean) yay -Sc ;;
    *) yay "$command" ;;
    esac
}

function run_pacman() {
    case "$command" in
    add) sudo pacman -S "$pkg" --noconfirm ;;
    rm) sudo pacman -R "$pkg" ;;
    up) sudo pacman -Syu ;;
    sync) sudo pacman -Sy ;;
    clean) sudo pacman -Scc ;;
    *) pacman -Ss "$command" ;;
    esac
}

function run_dnf() {
    case "$command" in
    add) sudo dnf install -y "$pkg" ;;
    rm) sudo dnf remove "$pkg" ;;
    up | sync) sudo dnf upgrade ;;
    clean) sudo dnf autoremove -y && sudo dnf clean all ;;
    *) sudo dnf search "$command" ;;
    esac
}

function run_apt() {
    case "$command" in
    add) sudo apt install -y "$pkg" ;;
    rm) sudo apt remove -y "$pkg" ;;
    up) sudo apt upgrade ;;
    sync) sudo apt update ;;
    clean) sudo apt autoremove && sudo apt clean ;;
    *) sudo apt search "$command" ;;
    esac
}

function main() {
    [[ -z "$command" ]] && help && exit 1

    case "$distro" in
    arch) run_yay $command $pkg ;;
    fedora) run_dnf $command $pkg ;;
    debian | ubuntu) run_apt $command $pkg ;;
    *) echo "px doesnt support your distro" ;;
    esac
}

distro=$(sed -n 's/^ID=//p' /etc/os-release)
command=$1
pkg=$2

main "$@"
